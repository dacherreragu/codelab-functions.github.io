<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Point Cloud</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section id="themes">
					<h2>Themes</h2>
					<p>
						<!-- Hacks to swap themes after the page has loaded. Not flexible and only intended for the reveal.js demo deck. -->
						<a href="#" onclick="document.getElementById('theme').setAttribute('href','css/theme/black.css'); return false;">Black (default)</a> -
						<a href="#" onclick="document.getElementById('theme').setAttribute('href','css/theme/white.css'); return false;">White</a> -
						<a href="#" onclick="document.getElementById('theme').setAttribute('href','css/theme/league.css'); return false;">League</a> -
						<a href="#" onclick="document.getElementById('theme').setAttribute('href','css/theme/sky.css'); return false;">Sky</a> -
						<a href="#" onclick="document.getElementById('theme').setAttribute('href','css/theme/beige.css'); return false;">Beige</a> -
						<a href="#" onclick="document.getElementById('theme').setAttribute('href','css/theme/simple.css'); return false;">Simple</a> <br>
						<a href="#" onclick="document.getElementById('theme').setAttribute('href','css/theme/serif.css'); return false;">Serif</a> -
						<a href="#" onclick="document.getElementById('theme').setAttribute('href','css/theme/blood.css'); return false;">Blood</a> -
						<a href="#" onclick="document.getElementById('theme').setAttribute('href','css/theme/night.css'); return false;">Night</a> -
						<a href="#" onclick="document.getElementById('theme').setAttribute('href','css/theme/moon.css'); return false;">Moon</a> -
						<a href="#" onclick="document.getElementById('theme').setAttribute('href','css/theme/solarized.css'); return false;">Solarized</a>
					</p>
				</section>

				<section>
					<h1>KINECT AND PROCESSING</h1>
					<h3>POINT CLOUD</h3>
					<p>
						<small>Created by <a href="https://chala8.github.io" target=”_blank”>Daniel Chala</a> / <a href="https://dacherreragu.github.io/" target=”_blank”>David Herrera</a></small>
					</p>
				</section>

				<section>
					<h2>INDEX</h2>
					<ol>
						<li class="fragment"><a href="#/3">Kinect</a></li>
						<li class="fragment"><a href="#/4">Processing </a></li>
						<li class="fragment"><a href="#/5">Point Cloud</a></li>
					</ol>
				</section>

				<section>
					<section>
						<h1>KINECT</h1>
					</section>
					<section>
						<h2>KINECT</h2>
						<img src="images/kinect.png">
					</section>
					<section>
						<h2>OVERVIEW</h2>
						<p>The Microsoft Kinect sensor is a peripheral device that functions much like a webcam. However, in addition to providing an RGB image, it also provides a depth map. Meaning for every pixel seen by the sensor, the Kinect measures distance from the sensor.</p>
					</section>
					<section>
						<h2>HOW DOES KINECT WORKS?</h2>
						<p>The Kinect sensor itself only measures color and depth.</p>
						<div class="fragment">Once that information is on your computer, lots more can be done like “skeleton” tracking.</div>
					</section>
					<section>
						<h2>SKELETON TRACKING</h2>	
						<p><span class="fragment">Windows: </span> <span class="fragment"><a href="https://github.com/ThomasLengeling/KinectPV2" target=”_blank”>Thomas Lengling’s windows-only Kinect v2 processing libray</a>.</span>
						<div class="fragment">Mac: </div> <span class="fragment"><a href="https://github.com/OpenKinect/libfreenect" target=”_blank”>libfreenect</a> and <a href="https://github.com/OpenKinect/libfreenect2" target=”_blank”>libfreenect2</a>.</span>
						</p>					
					</section>
					<section>
						<h2>HARDWARE</h2>	
						<p><span class="fragment">Standalone Kinect Sensor v1.</span>
						<div class="fragment">Standalone Kinect Sensor v2.</div>
						</p>					
					</section>
				</section>

				<section>
					<section>
						<h1>PROCESSING</h1>
					</section>
					<section>
						<h2>PROCESSING</h2>
						<img src="images/processing.png">
					</section>
					<section>
						<h2>OVERVIEW</h2>
						<p><a href="https://processing.org/" target="_blank">Processing</a> is an open source programming language and environment for people who want to create images, animations, and interactions.</p>
					</section>
					<section>
						<h2>START WITH KINECT IN PROCESSING</h2>
						<p>The easiest way to install the library is with the <a href="https://processing.org/reference/environment/#Extensions" target="_blank">Processing Contributions Manager</a> Sketch → Import Libraries → Add library and search for “Kinect”. A button will appear labeled “install”.
						<br>
						Then, restart Processing.</p>
					</section>
					<section data-markdown>
						## CODE
						First thing is to include the proper import statements at the top of your code.
						```
						import org.openkinect.processing.*;
						```
					</section>
					<section data-markdown>
						## CODE
						As well as a reference to a Kinect object, i.e.
						```
						Kinect kinect;
						```
					</section>
					<section data-markdown>
						## CODE
						Then in setup() you can initialize that kinect object:
						```
						void setup() {
  							kinect = new Kinect(this);
  							kinect.initDevice();
						}
						```
					</section>
					<section data-markdown>
						## CODE
						If you are using a Kinect v2, use a Kinect2 object instead.
						```
						Kinect2 kinect2;

						void setup() {
  							kinect2 = new Kinect2(this);
  							kinect2.initDevice();
						}
						```
					</section>
					<section data-markdown>
						## CODE
						Once you’ve done this you can begin to access data from the kinect sensor. 
						```
						PImage (RGB) from the kinect video camera.
						PImage (grayscale) from the kinect IR camera.
  						PImage (grayscale) with each pixel’s brightness mapped to depth (brighter = closer).
						PImage (RGB) with each pixel’s hue mapped to depth.
						int[] array with raw depth data (11 bit numbers between 0 and 2048).
						```
					</section>
					<section data-markdown>
						## CODE
						If you want to use the Kinect just like a regular old webcam, you can access the video image as a PImage!
						```
						PImage img = kinect.getVideoImage();
						image(img, 0, 0);
						```
					</section>
					<section data-markdown>
						## CODE
						If you want the IR image:
						```
						void videoEvent(Kinect k) {
 							// There has been a video event!
						}
						```
					</section>
					<section data-markdown>
						## CODE
						If you want the IR image:
						```
						kinect.enableIR(true);
						```
					</section>
					<section data-markdown>
						## CODE
						With kinect v1 cannot get both the video image and the IR image. They are both passed back via getVideoImage() so whichever one was most recently enabled is the one you will get. However, with the Kinect v2, they are both available as separate methods:
						```
						PImage video = kinect2.getVideoImage();
						PImage ir = kinect2.getIrImage();
						```
					</section>
					<section data-markdown>
						## CODE
						If you want the depth image, you can request the grayscale image:
						```
						PImage img = kinect.getDepthImage();
						image(img, 0, 0);
						```
					</section>
					<section data-markdown>
						## CODE
						As well as the raw depth data:
						For the kinect v1, the raw depth values range between 0 and 2048, for the kinect v2 the range is between 0 and 4500.
						```
						int[] depth = kinect.getRawDepth();
						```
					</section>
					<section data-markdown>
						## CODE
						For the color depth image, use kinect.enableColorDepth(true);. And just like with the video image, there’s a depth event you can access if necessary.
						```
						void depthEvent(Kinect k) {
 							// There has been a depth event!
						}
						```
					</section>
					<section data-markdown>
						## CODE
						Unfortunately, b/c the RGB camera and the IR camera are not physically located in the same spot, there is a stereo vision problem.
						The Kinect v2 offers what’s called a “registered” image which aligns all the depth values with the RGB camera ones. This can be accessed as follows:
						```
						PImage img = kinect2.getRegisteredImage()
						```
					</section>
					<section data-markdown>
						## CODE
						Finally, for kinect v1 (but not v2), you can also adjust the camera angle with the  setTilt() method.
						```
						float angle = kinect.getTilt();
						angle = angle + 1;
						kinect.setTilt(angle);
						```
					</section>
					<section data-markdown>
						## CODE
						Here are all the useful functions you might need to use the Processing kinect library:
						```
						initDevice() — start everything (video, depth, IR)
						activateDevice(int) - activate a specific device when multiple devices are connect
						initVideo() — start video only
						enableIR(boolean) — turn on or off the IR camera image (v1 only)
						initDepth() — start depth only
						enableColorDepth(boolean) — turn on or off the depth values as color image
						enableMirror(boolean) — mirror the image and depth data (v1 only)
						PImage getVideoImage() — grab the RGB (or IR for v1) video image
						PImage getIrImage() — grab the IR image (v2 only)
	     				PImage getDepthImage() — grab the depth map image
						PImage getRegisteredImage() — grab the registered depth image (v2 only)
						int[] getRawDepth() — grab the raw depth data
						float getTilt() — get the current sensor angle (between 0 and 30 degrees) (v1 only)
						setTilt(float) — adjust the sensor angle (between 0 and 30 degrees) (v1 only)
						```
					</section>
				</section>
				<section>
					<section>
						<h1>POINT CLOUD</h1>
					</section>
					<section>
						<h2>Overview</h2>
						<p>We’re using the 3D capabilities of Processing to draw points in space.</p>
						<div class="fragment">You’ll want to familiarize yourself with:</div>
						<div class="fragment" data-markdown>
							```
							translate()
							rotate()
							pushMatrix()
							popMatrix()
							```
						</div>
					</section>
					<section>
						<h2>Raw depth values</h2>
						<p>Rather than do this calculation all the time, we can precompute all of these values in a lookup table since there are only 2048 depth values.</p>
						<div class="fragment" data-markdown>
							```
							depthInMeters = 1.0 / (rawDepth * -0.0030711016 + 3.3309495161);
							```
						</div>
					</section>
					<section>
						<h2>Raw depth values</h2>
						<p>The raw depth values from the kinect are not directly proportional to physical depth. Rather, they scale with the inverse of the depth according to this formula:</p>
						<div class="fragment" data-markdown>
							```
							float[] depthLookUp = new float[2048];

							for (int i = 0; i < depthLookUp.length; i++) {
  								depthLookUp[i] = rawDepthToMeters(i);
							}
							float rawDepthToMeters(int depthValue) {
  								if (depthValue < 2047) {
    									return (float)(1.0 / ((double)(depthValue) * -0.0030711016 + 3.3309495161));
  								}
  								return 0.0f;
							}
							```
						</div>
					</section>
					<section>
						<h2>Raw depth values</h2>
						<p>Thanks to <a href="http://graphics.stanford.edu/~mdfisher/Kinect.html" target="_blank">Matthew Fisher</a> for the above formula.</p>
						<p><span class="fragment">Note:</span> <span class="fragment">For the results to be more accurate, you would need to calibrate your specific kinect device.</span></p>
					</section>
					<section>
						<h2>Point cloud</h2>
						<p>Finally, we can draw some points based on the depth values in meters:</p>
						<div class="fragment" data-markdown>
							```
							for(int x = 0; x < w; x += skip) {
    								for(int y = 0; y < h; y += skip) {
     							 		int offset = x + y * kinect.width;

      									// Convert kinect data to world xyz coordinate
      									int rawDepth = depth[offset];
      									PVector v = depthToWorld(x, y, rawDepth);

      									stroke(255);
     									pushMatrix();
      									// Scale up by 200
     									float factor = 200;
      									translate(v.x * factor, v.y * factor, factor-v.z * factor);
      									// Draw a point
      									point(0,0);
      									popMatrix();
    								}
  							}
							```
						</div>
					</section>
					<section>
						<h2>Obtained result</h2>
						<img src="images/result.png">
					</section>
					<section>
						<h2>Related video</h2>
						<p>The following video is a great resource for this implementation:</p>
						<iframe width="600" height="400" src="https://www.youtube.com/embed/E1eIg54clGo" frameborder="0" allowfullscreen class="fragment"></iframe>
					</section>
				</section>
				<section>
					<section>
						<h2>References</h2>
						<ul>
							<li class="fragment"><a href="https://es.wikipedia.org/wiki/Kinect" target="_blank">Kinect</a>.</li>
							<li class="fragment"><a href="https://processing.org/" target="_blank">Processing</a>.</li>
							<li class="fragment"><a href="http://shiffman.net/p5/kinect/" target="_blank">Getting Started with Kinect and Processing</a>.</li>
						</ul>
					</section>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
